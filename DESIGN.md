# Realtime Diagram Editor - 설계 문서
=================================

## 1. 프로젝트 개요
---------------
본 프로젝트는 시스템 공학 도구에서 여러 사용자가 동시에 다이어그램을 실시간으로 편집할 수 있는 기능을 제공하는 웹 기반 협업 다이어그램 편집기입니다.  
React를 기반으로 한 클라이언트와 Node.js (Express + Socket.io)를 기반으로 한 서버로 구성됩니다.  
다수의 사용자가 사각형과 선을 다이어그램에 추가하거나 이동시키면, 이 변화는 1초 이내의 지연으로 다른 사용자에게 실시간으로 전파됩니다.

## 2. 아키텍처 다이어그램 (텍스트 기반)
-----------------------------------
```
클라이언트 (React 앱, 브라우저)
    └──> WebSocket(Socket.io) ────────> 서버 (Node.js + Express + Socket.io)
                                              └─ in-memory diagram state
```

[ 사용자는 React 기반 웹 페이지를 통해 다이어그램을 조작하고,  
  클라이언트는 WebSocket을 통해 서버에 변경 사항을 전송하며,  
  서버는 메모리에 다이어그램 상태를 저장하고, 모든 클라이언트에 실시간 전파합니다. ]

```
+-------------------------+         WebSocket (Socket.io)          +--------------------------+
|   클라이언트 (React)     |  <---------------------------------->  |   서버 (Node.js + Express) |
|-------------------------|                                       |--------------------------|
| - Canvas 렌더링         |                                       | - Express 서버 실행       |
| - 사각형/선 추가 버튼    |                                       | - Socket.io WebSocket 서버|
| - 드래그 이동 처리       |                                       | - diagramState 메모리 저장|
| - 선택/삭제 처리         |                                       | - diagram-state.json 파일 |
| - 서버로 update emit     |                                       |   저장/로드               |
| - 서버에서 init/update 수신|                                     | - update broadcast        |
+-------------------------+                                       +--------------------------+
```

## 3. 주요 컴포넌트
----------------
### (1) 클라이언트 (React)
-----------------------
- **App.js**
  - Socket.io 클라이언트 초기화 및 서버 연결
  - 'init', 'update' 이벤트 리스닝
  - 다이어그램 상태 렌더링 및 업데이트
  - 사용자 액션 (사각형/선 추가, 이동 등) 처리 및 서버에 전송
  - SVG 또는 Canvas를 이용한 다이어그램 그리기
  - 마우스 이벤트 처리 (클릭, 드래그 등)
  - 사각형/선 추가 버튼 제공
  - 선택/삭제/이동 등 다이어그램 편집 툴 제공

### (2) 서버 (Node.js)
-------------------
- **index.js**
  - Express 기반 HTTP 서버 초기화
  - Socket.io 서버 초기화 및 클라이언트 접속 관리
  - 메모리 내 diagramState (예: `{ elements: [] }`) 유지
  - 클라이언트 접속 시 `init` 이벤트로 현재 상태 전송
  - 클라이언트로부터 `update` 이벤트 수신 시 상태 갱신 및 브로드캐스트

## 4. 데이터 구조
--------------
diagramState (서버 메모리, JSON 형태)
예:
```
{
  "elements": [
    { "id": 1, "type": "rectangle", "x": 100, "y": 150, "width": 80, "height": 40 },
    { "id": 2, "type": "line", "x1": 100, "y1": 150, "x2": 200, "y2": 250 }
  ]
}
```

각 요소에는 고유 ID가 있으며, 클라이언트와 서버는 이 ID를 기반으로 요소를 관리합니다.

## 5. 데이터 흐름
--------------
### 1️⃣ 클라이언트 접속  
→ 서버가 `init` 이벤트로 diagramState 전달  
→ 클라이언트가 다이어그램 화면에 반영  

### 2️⃣ 클라이언트에서 요소 추가/이동  
→ 서버에 `update` 이벤트로 새로운 diagramState 전송  
→ 서버는 diagramState 갱신  
→ 서버는 다른 클라이언트에 `update` 브로드캐스트  

### 3️⃣ 클라이언트 새로고침/재접속  
→ 서버에서 최신 상태 전달  

## 6. 주요 기술
------------
- **React**: UI 렌더링, 상태 관리
- **Node.js + Express**: 서버 구동
- **Socket.io**: WebSocket 기반 실시간 통신
- **메모리 상태 저장**: diagramState를 단순 JSON 객체로 메모리에 보관

## 7. 향후 개선 포인트
-------------------
- 다이어그램 상태를 데이터베이스에 저장
- 사용자 인증 및 세션 관리
- 요소 속성(색상, 라벨 등) 추가

끝.